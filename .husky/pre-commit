# Check for secrets before running lint-staged
echo "üîç Scanning for secrets..."

# Check if gitleaks is installed
if command -v gitleaks &> /dev/null; then
  gitleaks protect --staged --verbose --redact --config=.gitleaks.toml

  if [ $? -ne 0 ]; then
    echo "‚ùå Secret detected! Commit blocked."
    echo ""
    echo "üí° If this is a false positive:"
    echo "   1. Add inline comment: // gitleaks:allow"
    echo "   2. Update .gitleaks.toml allowlist"
    echo "   3. Emergency bypass: SKIP=gitleaks git commit -m 'message'"
    exit 1
  fi
  echo "‚úÖ No secrets detected"
else
  echo "‚ö†Ô∏è  Gitleaks not installed. Skipping secret scan."
  echo "   Install: brew install gitleaks (macOS) or see https://github.com/gitleaks/gitleaks"
fi

# Run lint-staged
pnpm lint-staged
